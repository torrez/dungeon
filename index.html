<html>
<head>
</head>
<body>
<canvas id="game" width="800" height="600"></canvas>

<script>
	var canvas;
	var canvasContext;
	var px;
	var py;
	var pd = 20;
	var ps = 20;
	var walls = [];

	window.onload=function(){
		canvas = document.getElementById('game');
		canvasContext = canvas.getContext('2d');
		px = canvas.width - 20;
		py = canvas.height - 20;
		document.addEventListener('keypress', keypress);
		document.addEventListener('keydown', keypress);

		createMap();
		drawEverything();
	}

	function createMap(){
		var top_wall = new wallRect(0, 0, canvas.width, 10);
		var left_side_wall = new wallRect(0, 10, 10, canvas.height);
		var right_side_wall = new wallRect(canvas.width - 10, 10, 10, canvas.height - 10);
		var bottom_wall = new wallRect(10, canvas.height - 10, canvas.width - 20, 10);

		walls.push(bottom_wall);
		walls.push(right_side_wall);
		walls.push(left_side_wall);
		walls.push(top_wall);

	}

	function drawMap(){
		canvasContext.fillStyle = 'grey';

		walls.forEach(function(value){
			value.draw(canvasContext);
		});
	}

	function keypress(key){
		switch(key.which){
			case 37:
			case 97: //a
				move_player_left();
				break;
			case 38:	
			case 119: //w
				move_player_up();
				break;
			case 40:
			case 115: //s
				move_player_down();
				break;
			case 39:
			case 100: //d
				move_player_right();
				break;
		}
		moveGame();
		drawEverything();
	}

	function can_move(x, y){
		for (i=0;i<walls.length;i++){	
			if (walls[i].contains(x, y)){
				return false;
			}	
		}
		return true;
	}

	function move_player_left(){
		mx = px - ps;
		if(!can_move(mx, py)){
			return false;
		}
		px = px - ps;
	}
	function move_player_right(){
		mx = px + ps;
		if(!can_move(mx, py)){
			return false;
		}	
		px = px + ps;
	}
	function move_player_up(){
		my = py - 10;
		if(!can_move(px, my)){
			return false;
		}
		py = py - ps;
	}
	function move_player_down(){
		my = py + 10;
		if(!can_move(px, my)){
			return false;
		}
		py = py + ps;
	}

	function drawEverything(){
		canvasContext.fillStyle = 'black';
		canvasContext.fillRect(0,0, canvas.width, canvas.height);

		drawMap();
		canvasContext.fillStyle = 'white';
		canvasContext.fillRect(px-(pd/2), py - (pd/2), pd, pd);
	}

	function moveGame(){

	}

	function wallRect(x, y, w, h) {
		this.x = x;
		this.y = y;
		this.width = w;
		this.height = h;

		this.contains = function (x, y) {
			return this.x <= x && x <= this.x + this.width &&
			       this.y <= y && y <= this.y + this.height;
		}

		this.draw = function (ctx) {
			ctx.fillRect(this.x, this.y, this.width, this.height)
		}
}
</script>
</body>
</html>
